<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Admin Dashboard</title>
</head>
<body>
  <h2>Admin Dashboard</h2>
  <button onclick="logout()">Logout</button>
  <h3>Current Round Result: <span id="latestResult">Loading...</span></h3>
  <button onclick="generateResult()">Generate Result</button>
  <h3>All Bets:</h3>
  <ul id="allBets"></ul>

  <script>
    const API = "https://wingo-backend-nqk5.onrender.com";
    const role = localStorage.getItem("role");
    if (role !== "admin") location.href = "index.html";

    function logout() {
      localStorage.clear();
      location.href = "index.html";
    }

    async function fetchAllBets() {
      const res = await fetch(`${API}/api/bets`);
      const bets = await res.json();
      document.getElementById("allBets").innerHTML = bets.slice(0, 20).map(b =>
        `<li>${b.username} bet â‚¹${b.amount} on ${b.color} [${b.status}]</li>`
      ).join("");
    }

    async function loadLatestResult() {
      const res = await fetch(`${API}/api/rounds`);
      const rounds = await res.json();
      const latest = rounds.find(r => r.result);
      document.getElementById("latestResult").textContent = latest ? latest.result : "Pending...";
    }

    async function generateResult() {
      const res = await fetch(`${API}/api/admin/generate-result`, { method: "POST" });
      const json = await res.json();
      alert(json.message);
      loadLatestResult();
      fetchAllBets();
    }

    fetchAllBets();
    loadLatestResult();
    setInterval(() => { loadLatestResult(); fetchAllBets(); }, 10000);
  </script>
</body>
</html>
