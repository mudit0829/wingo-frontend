<!DOCTYPE html>
<html>
<head>
  <title>Admin Dashboard</title>
</head>
<body>
  <h1>Welcome, Admin</h1>
  <button onclick="startTimer()">Start Timer</button>
  <button onclick="generateResult()">Generate Result</button>
  <button onclick="logout()">Logout</button>
  <table>
    <thead>
      <tr><th>Round ID</th><th>Result</th><th>Timestamp</th></tr>
    </thead>
    <tbody id="roundsTB"></tbody>
  </table>

  <script>
    const API = 'https://wingo-backend-nqk5.onrender.com';

    function logout() {
      localStorage.clear();
      location = 'index.html';
    }

    async function startTimer() {
      try {
        const r = await fetch(`${API}/api/cron/start`, { method: 'POST' }).then(r => r.json());
        alert(r.message || 'Timer started');
        loadRounds();
      } catch (e) { alert('Error starting timer') }
    }

    async function generateResult() {
      try {
        const r = await fetch(`${API}/api/cron/generate-result`, { method: 'POST' }).then(r => r.json());
        if (!r.result) throw new Error(r.message || 'Unknown');
        alert('Result: ' + r.result);
        loadRounds();
      } catch (e) { alert('⚠️ Failed to generate result'); }
    }

    async function loadRounds() {
      try {
        const rounds = await fetch(`${API}/api/rounds`).then(r => r.json());
        const tb = document.getElementById('roundsTB');
        tb.innerHTML = '';
        rounds.reverse().forEach(r => {
          const tr = document.createElement('tr');
          const dt = new Date(r.timestamp);
          tr.innerHTML = `<td>${r.roundId}</td><td>${r.result || '-'}</td><td>${isNaN(dt)?'Invalid Date':dt.toLocaleString()}</td>`;
          tb.appendChild(tr);
        });
      } catch (e) { console.error(e) }
    }

    loadRounds();
  </script>
</body>
</html>
