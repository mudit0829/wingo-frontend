<!DOCTYPE html>
<html>
<head>
  <title>Admin Dashboard</title>
  <style>
    body { font-family: Arial; padding: 20px; }
    button { margin: 0 10px 20px 0; padding: 10px; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { border: 1px solid #ccc; padding: 10px; text-align: left; }
  </style>
</head>
<body>

  <h1>Admin Dashboard</h1>
  <button onclick="startTimer()">Start Timer</button>
  <button onclick="generateResult()">Generate Result</button>
  <button onclick="logout()" style="float: right;">Logout</button>

  <table id="roundsTable">
    <thead>
      <tr><th>Round ID</th><th>Result</th><th>Timestamp</th></tr>
    </thead>
    <tbody></tbody>
  </table>

<script>
  const apiBase = 'https://wingo-backend-nqk5.onrender.com';

  async function fetchRounds() {
    try {
      const res = await fetch(`${apiBase}/api/rounds`);
      const rounds = await res.json();

      const tbody = document.querySelector("#roundsTable tbody");
      tbody.innerHTML = "";

      rounds.reverse().forEach(r => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${r.roundId || "-"}</td>
          <td>${r.result || "-"}</td>
          <td>${r.timestamp ? new Date(r.timestamp).toLocaleString() : "-"}</td>
        `;
        tbody.appendChild(tr);
      });
    } catch (err) {
      console.error("Error fetching rounds:", err);
    }
  }

  function startTimer() {
    fetch(`${apiBase}/api/cron/start`, { method: 'POST' })
      .then(() => alert("⏱️ Timer started"));
  }

  function generateResult() {
    fetch(`${apiBase}/api/cron/generate`, { method: 'POST' })
      .then(res => res.json())
      .then(() => {
        alert("✅ Result generated!");
        fetchRounds();
      })
      .catch(() => alert("❌ Failed to generate result"));
  }

  function logout() {
    localStorage.clear();
    window.location.href = 'index.html';
  }

  fetchRounds();
</script>

</body>
</html>
