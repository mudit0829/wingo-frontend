<!DOCTYPE html>
<html>
<head>
  <title>Admin Panel</title>
</head>
<body>
  <h1>Welcome, Admin</h1>
  <button onclick="startTimer()">Start Timer</button>
  <button onclick="generateResult()">Generate Result</button>
  <button onclick="logout()">Logout</button>

  <table border="1">
    <thead>
      <tr>
        <th>Round ID</th>
        <th>Result</th>
        <th>Timestamp</th>
      </tr>
    </thead>
    <tbody id="roundsTable"></tbody>
  </table>

  <script>
  const API_URL = 'https://wingo-backend-nqk5.onrender.com';

  async function fetchRounds() {
    const res = await fetch(`${API_URL}/api/rounds`);
    const rounds = await res.json();
    const table = document.getElementById('roundTable');

    table.innerHTML = `
      <tr>
        <th>Round ID</th>
        <th>Result</th>
        <th>Timestamp</th>
      </tr>
    `;

    rounds.reverse().forEach(round => {
      const row = document.createElement('tr');
      row.innerHTML = `
        <td>${round.roundId}</td>
        <td>${round.result}</td>
        <td>${new Date(round.timestamp).toLocaleString()}</td>
      `;
      table.appendChild(row);
    });
  }

  async function generateResult() {
    try {
      const res = await fetch(`${API_URL}/api/cron/generate-result`, {
        method: 'POST',
      });

      if (!res.ok) {
        throw new Error(`Error ${res.status}`);
      }

      alert('✅ New result generated!');
      fetchRounds();
    } catch (error) {
      console.error('Error:', error);
      alert('❌ Failed to generate result.');
    }
  }

  function logout() {
    localStorage.removeItem('user');
    window.location.href = 'index.html';
  }

  document.getElementById('generateBtn').addEventListener('click', generateResult);
  document.getElementById('logoutBtn').addEventListener('click', logout);

  fetchRounds();
</script>
</body>
</html>
