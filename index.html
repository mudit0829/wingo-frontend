<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>WinGo Game</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
  <style>
    body {
      margin: 0;
      font-family: sans-serif;
      background: #111;
      color: white;
      text-align: center;
    }
    header {
      padding: 10px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    header img {
      height: 40px;
    }
    .wallet {
      margin: 10px 0;
      font-size: 20px;
    }
    .wallet-buttons button {
      margin: 5px;
      padding: 8px 15px;
      font-size: 16px;
      border: none;
      border-radius: 6px;
    }
    .deposit {
      background-color: green;
      color: white;
    }
    .withdraw {
      background-color: red;
      color: white;
    }
    .round {
      margin: 10px;
      font-size: 18px;
    }
    .timer {
      font-size: 24px;
      font-weight: bold;
    }
    .color-tabs, .number-tabs {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      margin: 10px;
    }
    .color-tabs button, .number-tabs button {
      margin: 5px;
      padding: 10px 20px;
      font-size: 16px;
      border: none;
      border-radius: 6px;
      min-width: 80px;
      text-transform: uppercase;
    }
    .red { background-color: red; color: white; }
    .green { background-color: green; color: white; }
    .violet { background-color: violet; color: white; }
    .popup, .history-modal {
      position: fixed;
      bottom: -100%;
      left: 0;
      width: 100%;
      background: #222;
      padding: 20px;
      transition: bottom 0.3s;
      border-radius: 20px 20px 0 0;
      z-index: 10;
    }
    .popup.show, .history-modal.show {
      bottom: 0;
    }
    .popup button, .history-modal button {
      margin: 5px;
      padding: 10px;
      font-size: 16px;
      border-radius: 8px;
    }
    .amount-options button, .multiplier-options button {
      padding: 10px;
      margin: 5px;
      font-size: 14px;
    }
    .history-buttons {
      margin-top: 10px;
    }
    .history-buttons button {
      padding: 10px 20px;
      margin: 5px;
    }
    table {
      width: 100%;
      background: #333;
      color: white;
      border-collapse: collapse;
    }
    th, td {
      padding: 8px;
      border: 1px solid #444;
    }
    @media screen and (max-width: 600px) {
      .color-tabs, .number-tabs {
        flex-direction: row;
        flex-wrap: wrap;
      }
    }
  </style>
</head>
<body>
  <header>
    <div></div>
    <img src="logo.png" alt="Logo">
    <i class="fas fa-user-circle fa-2x" style="color:white;"></i>
  </header>

  <div class="wallet">Wallet: ₹<span id="walletAmount">0.00</span></div>
  <div class="wallet-buttons">
    <button class="withdraw">Withdraw</button>
    <button class="deposit">Deposit</button>
  </div>

  <div class="round">
    Round: <span id="roundId">-</span> | <span class="timer" id="timer">--</span>
  </div>

  <div class="color-tabs">
    <button class="red" onclick="openPopup('Red')">Red</button>
    <button class="green" onclick="openPopup('Green')">Green</button>
    <button class="violet" onclick="openPopup('Violet')">Violet</button>
  </div>

  <div class="number-tabs" id="numberTabs"></div>

  <div class="history-buttons">
    <button onclick="openHistory('my')">My History</button>
    <button onclick="openHistory('game')">Game History</button>
  </div>

  <!-- Bet Popup -->
  <div class="popup" id="betPopup">
    <h3>Place Bet: <span id="betType"></span></h3>
    <div class="amount-options">
      <button onclick="selectAmount(1)">₹1</button>
      <button onclick="selectAmount(10)">₹10</button>
      <button onclick="selectAmount(100)">₹100</button>
    </div>
    <div class="multiplier-options">
      <button onclick="selectMultiplier(2)">x2</button>
      <button onclick="selectMultiplier(5)">x5</button>
      <button onclick="selectMultiplier(10)">x10</button>
      <button onclick="selectMultiplier(50)">x50</button>
      <button onclick="selectMultiplier(100)">x100</button>
    </div>
    <div>Total: ₹<span id="totalAmount">0</span></div>
    <button onclick="placeBet()">Place Bet</button>
    <button onclick="closePopup()">Cancel</button>
  </div>

  <!-- History Modal -->
  <div class="history-modal" id="historyModal">
    <h3 id="historyTitle"></h3>
    <div id="historyContent">Loading...</div>
    <button onclick="closeHistory()">Close</button>
  </div>

  <script>
    const userEmail = "user@example.com";
    let selectedAmount = 0;
    let selectedMultiplier = 1;
    let selectedType = "";

    function fetchWallet() {
      fetch(`https://wingo-backend-nqk5.onrender.com/api/users/wallet/${userEmail}`)
        .then(res => res.json())
        .then(data => {
          document.getElementById("walletAmount").textContent = data.wallet.toFixed(2);
        })
        .catch(err => console.error("wallet fetch error:", err));
    }

    function fetchCurrentRound() {
      fetch(`https://wingo-backend-nqk5.onrender.com/api/rounds`)
        .then(res => res.json())
        .then(data => {
          const latest = data[data.length - 1];
          document.getElementById("roundId").textContent = latest.roundId || "-";
        });
    }

    function startTimer(seconds = 30) {
      let time = seconds;
      const timerEl = document.getElementById("timer");
      const interval = setInterval(() => {
        if (time <= 0) {
          clearInterval(interval);
          timerEl.textContent = "Waiting...";
          return;
        }
        timerEl.textContent = time + "s";
        time--;
      }, 1000);
    }

    function openPopup(type) {
      selectedType = type;
      document.getElementById("betType").textContent = type;
      document.getElementById("betPopup").classList.add("show");
    }

    function closePopup() {
      document.getElementById("betPopup").classList.remove("show");
      selectedAmount = 0;
      selectedMultiplier = 1;
      document.getElementById("totalAmount").textContent = "0";
    }

    function selectAmount(amt) {
      selectedAmount = amt;
      updateTotal();
    }

    function selectMultiplier(multi) {
      selectedMultiplier = multi;
      updateTotal();
    }

    function updateTotal() {
      document.getElementById("totalAmount").textContent = selectedAmount * selectedMultiplier;
    }

    function placeBet() {
      alert(`Placed bet of ₹${selectedAmount * selectedMultiplier} on ${selectedType}`);
      closePopup();
      fetchWallet(); // auto refresh wallet after bet
    }

    function openHistory(type) {
      document.getElementById("historyModal").classList.add("show");
      const title = type === "my" ? "My History" : "Game History";
      document.getElementById("historyTitle").textContent = title;
      if (type === "my") {
        fetch(`https://wingo-backend-nqk5.onrender.com/api/bets/user/${userEmail}`)
          .then(res => res.json())
          .then(data => {
            const html = `
              <table>
                <tr><th>Round</th><th>Color</th><th>Number</th><th>Status</th></tr>
                ${data.map(bet => `
                  <tr>
                    <td>${bet.roundId}</td>
                    <td>${bet.colorBet || '-'}</td>
                    <td>${bet.numberBet ?? '-'}</td>
                    <td>${bet.result || '-'}</td>
                  </tr>
                `).join("")}
              </table>`;
            document.getElementById("historyContent").innerHTML = html;
          });
      } else {
        document.getElementById("historyContent").innerHTML = "<i>Coming soon...</i>";
      }
    }

    function closeHistory() {
      document.getElementById("historyModal").classList.remove("show");
    }

    function renderNumberButtons() {
      const container = document.getElementById("numberTabs");
      for (let i = 0; i <= 9; i++) {
        const btn = document.createElement("button");
        btn.textContent = i;
        btn.onclick = () => openPopup(i.toString());
        container.appendChild(btn);
      }
    }

    fetchWallet();
    fetchCurrentRound();
    startTimer();
    renderNumberButtons();
  </script>
</body>
</html>
