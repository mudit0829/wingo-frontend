<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>WinGo Game</title>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: 'Roboto', sans-serif;
    }

    body {
      background-color: #f1f1f1;
      color: #333;
    }

    .container {
      max-width: 450px;
      margin: auto;
      padding: 1rem;
    }

    .wallet-section,
    .timer,
    .result,
    .color-buttons,
    .number-buttons,
    .bet-amount,
    .bet-actions,
    .history {
      background: #fff;
      border-radius: 10px;
      padding: 1rem;
      margin-bottom: 1rem;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05);
    }

    .wallet-section {
      display: flex;
      justify-content: space-between;
      font-size: 16px;
    }

    .timer,
    .result {
      text-align: center;
      font-size: 18px;
      font-weight: bold;
    }

    .color-buttons button,
    .number-buttons button {
      width: 30%;
      margin: 0.3rem;
      padding: 1rem 0;
      font-size: 16px;
      font-weight: bold;
      border: none;
      border-radius: 8px;
      color: #fff;
      cursor: pointer;
    }

    .color-buttons {
      display: flex;
      justify-content: space-between;
    }

    .color-buttons .green {
      background-color: #2ecc71;
    }

    .color-buttons .red {
      background-color: #e74c3c;
    }

    .color-buttons .violet {
      background-color: #9b59b6;
    }

    .number-buttons {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 0.5rem;
    }

    .number-buttons button {
      background-color: #3498db;
    }

    .bet-amount input {
      width: 100%;
      padding: 0.7rem;
      border: 1px solid #ccc;
      border-radius: 5px;
      font-size: 16px;
      margin-top: 0.5rem;
    }

    .bet-actions button {
      width: 100%;
      padding: 1rem;
      font-size: 16px;
      background-color: #2c3e50;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
    }

    .history table {
      width: 100%;
      border-collapse: collapse;
      font-size: 14px;
    }

    .history th,
    .history td {
      padding: 0.5rem;
      border: 1px solid #ddd;
      text-align: center;
    }
  </style>
</head>

<body>
  <div class="container">
    <div class="wallet-section">
      <div><strong>User:</strong> user@example.com</div>
      <div><strong>Wallet:</strong> â‚¹<span id="wallet">0</span></div>
    </div>

    <div class="timer">
      Time Left: <span id="countdown">--</span>s
    </div>

    <div class="result">
      Last Result: <span id="last-result">--</span>
    </div>

    <div class="color-buttons">
      <button class="green" onclick="selectColor('Green')">Green</button>
      <button class="red" onclick="selectColor('Red')">Red</button>
      <button class="violet" onclick="selectColor('Violet')">Violet</button>
    </div>

    <div class="number-buttons">
      <script>
        for (let i = 0; i < 10; i++) {
          document.write(`<button onclick="selectNumber(${i})">${i}</button>`);
        }
      </script>
    </div>

    <div class="bet-amount">
      <label for="amount">Enter Amount:</label>
      <input type="number" id="amount" min="1" />
    </div>

    <div class="bet-actions">
      <button onclick="placeBet()">Place Bet</button>
    </div>

    <div class="history">
      <h3>My Bets</h3>
      <table>
        <thead>
          <tr>
            <th>Round</th>
            <th>Color</th>
            <th>Number</th>
            <th>Amount</th>
            <th>Status</th>
          </tr>
        </thead>
        <tbody id="bet-history"></tbody>
      </table>
    </div>
  </div>

  <script>
    const BASE_URL = 'https://wingo-backend-nqk5.onrender.com';
    const username = 'user@example.com';

    let selectedColor = null;
    let selectedNumber = null;

    function selectColor(color) {
      selectedColor = color;
      selectedNumber = null;
      alert(`Selected Color: ${color}`);
    }

    function selectNumber(number) {
      selectedNumber = number;
      selectedColor = null;
      alert(`Selected Number: ${number}`);
    }

    async function fetchWallet() {
      const res = await fetch(`${BASE_URL}/api/users/${username}`);
      const data = await res.json();
      document.getElementById('wallet').textContent = data.wallet;
    }

    async function fetchRounds() {
      const res = await fetch(`${BASE_URL}/api/rounds`);
      const data = await res.json();
      const last = data[data.length - 1];
      document.getElementById('last-result').textContent = `${last.result} (${last.color})`;

      const now = new Date();
      const roundTime = new Date(last.timestamp);
      const diff = 30 - Math.floor((now - roundTime) / 1000);
      startCountdown(diff > 0 ? diff : 0);
    }

    function startCountdown(timeLeft) {
      const countdownEl = document.getElementById('countdown');
      const interval = setInterval(() => {
        if (timeLeft <= 0) {
          clearInterval(interval);
          countdownEl.textContent = '0';
        } else {
          countdownEl.textContent = timeLeft--;
        }
      }, 1000);
    }

    async function placeBet() {
      const amount = parseFloat(document.getElementById('amount').value);
      if ((!selectedColor && selectedNumber === null) || isNaN(amount)) {
        alert('Please select color or number and enter valid amount.');
        return;
      }

      const bet = {
        username,
        amount,
        color: selectedColor,
        number: selectedNumber
      };

      const res = await fetch(`${BASE_URL}/api/bets`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(bet)
      });

      if (res.ok) {
        alert('Bet placed!');
        document.getElementById('amount').value = '';
        fetchWallet();
        fetchHistory();
      } else {
        alert('Failed to place bet');
      }
    }

    async function fetchHistory() {
      const res = await fetch(`${BASE_URL}/api/bets/user/${username}`);
      const data = await res.json();
      const tbody = document.getElementById('bet-history');
      tbody.innerHTML = '';
      data.slice(-10).reverse().forEach(bet => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${bet.roundId || '--'}</td>
          <td>${bet.color || '-'}</td>
          <td>${bet.number !== null ? bet.number : '-'}</td>
          <td>${bet.amount}</td>
          <td>${bet.status || 'pending'}</td>
        `;
        tbody.appendChild(tr);
      });
    }

    fetchWallet();
    fetchRounds();
    fetchHistory();
    setInterval(fetchRounds, 5000);
  </script>
</body>

</html>
