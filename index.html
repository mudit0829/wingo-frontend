<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Wingo Game</title>
  <style>
    /* Reset and base */
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: Arial, sans-serif; background: #111; color: #fff; padding: 10px; }
    .center { text-align: center; }
    img.logo { width: 120px; margin: 10px auto; display: block; }

    /* Wallet */
    .wallet { background: #222; padding: 15px; border-radius: 10px; display: flex; justify-content: space-between; margin: 10px 0; }
    .wallet div { font-size: 1.1em; }
    .wallet button { padding: 6px 12px; background: #333; color: #fff; border: none; border-radius: 5px; cursor: pointer; }

    /* Color tabs */
    .color-tabs { display: flex; justify-content: space-around; margin: 20px 0; }
    .color-tabs button {
      flex: 1;
      margin: 5px;
      padding: 15px;
      font-size: 1.2em;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      color: white;
    }
    .green { background: #00c853; }
    .red { background: #d50000; }
    .violet { background: #8e24aa; }

    /* Number grid */
    .number-grid {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 10px;
      margin: 20px 0;
    }
    .number-circle {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.1em;
      color: white;
      cursor: pointer;
    }
    .red-bg { background: #d32f2f; }
    .green-bg { background: #388e3c; }

    /* Tabs */
    .tabs { display: flex; justify-content: space-around; margin-top: 20px; }
    .tabs button {
      flex: 1;
      padding: 10px;
      background: #222;
      color: white;
      border: none;
      border-bottom: 2px solid transparent;
      cursor: pointer;
    }
    .tabs button.active { border-color: yellow; }

    /* Table */
    table { width: 100%; border-collapse: collapse; margin-top: 10px; }
    th, td { border: 1px solid #555; padding: 8px; text-align: center; }
    th { background: #333; }

    /* Popup */
    #betModal {
      display: none;
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.8);
      justify-content: center;
      align-items: center;
    }
    .modal-content {
      background: #222;
      padding: 20px;
      border-radius: 10px;
      width: 90%;
      max-width: 400px;
    }
    .modal-content h3 { margin-bottom: 10px; }
    .amount-options button {
      margin: 5px;
      padding: 10px;
      background: #444;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <img src="https://mudit0829.github.io/wingo-frontend/logo.png" alt="Wingo Logo" class="logo">

  <div class="wallet">
    <div>Wallet: <span id="walletAmount">Loading...</span></div>
    <div>
      <button onclick="updateWallet(100)">Deposit</button>
      <button onclick="updateWallet(-100)">Withdraw</button>
    </div>
  </div>

  <div class="color-tabs">
    <button class="green" onclick="openBetPopup('green')">Green</button>
    <button class="violet" onclick="openBetPopup('violet')">Violet</button>
    <button class="red" onclick="openBetPopup('red')">Red</button>
  </div>

  <div class="number-grid" id="numberGrid"></div>

  <div class="tabs">
    <button class="active" onclick="showTab('game')">Game History</button>
    <button onclick="showTab('my')">My History</button>
  </div>

  <div id="gameHistory"></div>
  <div id="myHistory" style="display:none"></div>

  <div id="betModal">
    <div class="modal-content">
      <h3>Place Bet on <span id="betType"></span></h3>
      <div class="amount-options">
        <button onclick="selectAmount(10)">10</button>
        <button onclick="selectAmount(20)">20</button>
        <button onclick="selectAmount(50)">50</button>
        <button onclick="multiplyAmount(2)">×2</button>
        <button onclick="multiplyAmount(5)">×5</button>
        <button onclick="multiplyAmount(10)">×10</button>
      </div>
      <p>Total: ₹<span id="betAmount">0</span></p>
      <button onclick="placeBet()">Place Bet</button>
      <button onclick="closeBetPopup()">Cancel</button>
    </div>
  </div>

  <script>
    const email = "user@example.com";
    let selectedBet = { type: null, number: null };
    let currentAmount = 0;

    const API = "https://wingo-backend-nqk5.onrender.com";

    function fetchWallet() {
      fetch(`${API}/api/users/wallet/${email}`)
        .then(res => res.json())
        .then(data => {
          document.getElementById('walletAmount').textContent = `₹${data.balance}`;
        });
    }

    function updateWallet(amount) {
      fetch(`${API}/api/users/wallet/update`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ email, amount })
      })
      .then(res => res.json())
      .then(() => fetchWallet());
    }

    function openBetPopup(type, number = null) {
      selectedBet = { type, number };
      document.getElementById("betType").textContent = number ?? type;
      currentAmount = 0;
      document.getElementById("betAmount").textContent = 0;
      document.getElementById("betModal").style.display = "flex";
    }

    function closeBetPopup() {
      document.getElementById("betModal").style.display = "none";
    }

    function selectAmount(val) {
      currentAmount = val;
      document.getElementById("betAmount").textContent = val;
    }

    function multiplyAmount(multiplier) {
      currentAmount *= multiplier;
      document.getElementById("betAmount").textContent = currentAmount;
    }

    function placeBet() {
      const payload = {
        email,
        roundId: "dummy-round-id",
        amount: currentAmount,
        colorBet: selectedBet.number === null ? selectedBet.type : null,
        numberBet: selectedBet.number !== null ? selectedBet.number : null
      };

      fetch(`${API}/api/bets`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(payload)
      })
      .then(res => res.json())
      .then(() => {
        closeBetPopup();
        fetchWallet();
        fetchMyHistory();
      });
    }

    function fetchMyHistory() {
      fetch(`${API}/api/bets/user/${email}`)
        .then(res => res.json())
        .then(data => {
          const table = [`<table><tr><th>Type</th><th>Amount</th><th>Time</th></tr>`];
          data.reverse().forEach(b => {
            table.push(`<tr><td>${b.colorBet || b.numberBet}</td><td>₹${b.amount}</td><td>${new Date(b.timestamp).toLocaleString()}</td></tr>`);
          });
          table.push(`</table>`);
          document.getElementById("myHistory").innerHTML = table.join('');
        });
    }

    function showTab(tab) {
      document.getElementById("gameHistory").style.display = tab === 'game' ? 'block' : 'none';
      document.getElementById("myHistory").style.display = tab === 'my' ? 'block' : 'none';
      document.querySelectorAll(".tabs button").forEach(btn => btn.classList.remove("active"));
      document.querySelectorAll(".tabs button")[tab === 'game' ? 0 : 1].classList.add("active");
    }

    function initNumbers() {
      const grid = document.getElementById("numberGrid");
      for (let i = 0; i <= 9; i++) {
        const div = document.createElement("div");
        div.className = `number-circle ${i % 2 === 0 ? 'red-bg' : 'green-bg'}`;
        div.textContent = i;
        div.onclick = () => openBetPopup('number', i);
        grid.appendChild(div);
      }
    }

    fetchWallet();
    fetchMyHistory();
    initNumbers();
  </script>
</body>
</html>
