<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>WinGo Game</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0; padding: 0;
      background: #111;
      color: white;
      overflow-x: hidden;
    }
    header {
      padding: 10px;
      text-align: center;
      background: #222;
    }
    .balance-box {
      text-align: center;
      padding: 10px;
      background: #333;
    }
    .bet-buttons {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin: 15px 0;
      flex-wrap: wrap;
    }
    .bet-buttons button {
      padding: 10px 20px;
      font-size: 16px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      background: #555;
      color: #fff;
    }
    .number-buttons {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 10px;
      padding: 10px;
      max-width: 300px;
      margin: auto;
    }
    .number-buttons button {
      padding: 15px;
      border-radius: 50%;
      font-size: 18px;
      border: none;
      cursor: pointer;
      background: #444;
      color: white;
    }
    #historyPopup {
      position: fixed;
      bottom: -100%;
      left: 0;
      width: 100%;
      height: 70%;
      background: #222;
      border-top-left-radius: 20px;
      border-top-right-radius: 20px;
      box-shadow: 0 -4px 10px rgba(0,0,0,0.3);
      overflow-y: auto;
      transition: bottom 0.3s ease;
      z-index: 1000;
    }
    #historyPopup.open {
      bottom: 0;
    }
    .popup-header {
      padding: 15px;
      background: #333;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .tab-buttons {
      display: flex;
      justify-content: center;
      margin-top: 10px;
    }
    .tab-buttons button {
      flex: 1;
      padding: 10px;
      background: #444;
      border: none;
      color: white;
      font-weight: bold;
    }
    .tab-buttons button.active {
      background: #666;
    }
    .history-list {
      padding: 10px;
    }
    .history-item {
      border-bottom: 1px solid #444;
      padding: 10px 5px;
    }
    .history-item.win { color: #00ff00; }
    .history-item.loss { color: #ff4444; }
    .footer-btn {
      position: fixed;
      bottom: 10px;
      right: 20px;
      background: #ffcc00;
      color: #000;
      border: none;
      padding: 12px 18px;
      font-weight: bold;
      border-radius: 50px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.3);
      z-index: 999;
    }
  </style>
</head>
<body>

  <header>
    <h2>WinGo Game</h2>
  </header>

  <div class="balance-box">
    Wallet: ₹<span id="wallet">0</span>
  </div>

  <div class="bet-buttons">
    <button onclick="placeColorBet('Red')">Red</button>
    <button onclick="placeColorBet('Green')">Green</button>
    <button onclick="placeColorBet('Violet')">Violet</button>
  </div>

  <div class="number-buttons">
    ${[...Array(10).keys()].map(n => `<button onclick="placeNumberBet(${n})">${n}</button>`).join('')}
  </div>

  <button class="footer-btn" onclick="togglePopup()">My History</button>

  <!-- Bottom Popup -->
  <div id="historyPopup">
    <div class="popup-header">
      <span>Game History</span>
      <button onclick="togglePopup()" style="color:white;background:none;border:none;">✕</button>
    </div>

    <div class="tab-buttons">
      <button id="tab-my" class="active" onclick="showTab('my')">My History</button>
      <button id="tab-game" onclick="showTab('game')">Game History</button>
    </div>

    <div class="history-list" id="myHistory"></div>
    <div class="history-list" id="gameHistory" style="display:none;"></div>
  </div>

  <script>
    const userEmail = 'user@example.com';

    async function fetchWallet() {
      try {
        const res = await fetch(`https://wingo-backend-nqk5.onrender.com/api/users/wallet/${userEmail}`);
        const data = await res.json();
        document.getElementById('wallet').textContent = data.wallet.toFixed(2);
      } catch (e) {
        console.error('Wallet fetch error:', e);
      }
    }

    function togglePopup() {
      document.getElementById('historyPopup').classList.toggle('open');
      loadMyHistory();
    }

    function showTab(tab) {
      document.getElementById('tab-my').classList.remove('active');
      document.getElementById('tab-game').classList.remove('active');
      document.getElementById('myHistory').style.display = 'none';
      document.getElementById('gameHistory').style.display = 'none';

      if (tab === 'my') {
        document.getElementById('tab-my').classList.add('active');
        document.getElementById('myHistory').style.display = 'block';
        loadMyHistory();
      } else {
        document.getElementById('tab-game').classList.add('active');
        document.getElementById('gameHistory').style.display = 'block';
        loadGameHistory();
      }
    }

    async function loadMyHistory() {
      try {
        const res = await fetch(`https://wingo-backend-nqk5.onrender.com/api/bets/user/${userEmail}`);
        const data = await res.json();
        const container = document.getElementById('myHistory');
        container.innerHTML = '';
        data.reverse().forEach(bet => {
          const isWin = bet.status === 'win';
          container.innerHTML += `
            <div class="history-item ${isWin ? 'win' : 'loss'}">
              <div><strong>Round:</strong> ${bet.roundId}</div>
              <div><strong>Color:</strong> ${bet.color || '-'}</div>
              <div><strong>Number:</strong> ${bet.number !== null ? bet.number : '-'}</div>
              <div><strong>Amount:</strong> ₹${bet.amount}</div>
              <div><strong>Result:</strong> ${isWin ? 'Win' : 'Loss'}</div>
            </div>
          `;
        });
      } catch (e) {
        console.error('My History error:', e);
      }
    }

    async function loadGameHistory() {
      try {
        const res = await fetch(`https://wingo-backend-nqk5.onrender.com/api/rounds`);
        const data = await res.json();
        const container = document.getElementById('gameHistory');
        container.innerHTML = '';
        data.reverse().forEach(round => {
          container.innerHTML += `
            <div class="history-item">
              <div><strong>Round:</strong> ${round.roundId}</div>
              <div><strong>Result:</strong> ${round.result}</div>
              <div><strong>Time:</strong> ${new Date(round.timestamp).toLocaleTimeString()}</div>
            </div>
          `;
        });
      } catch (e) {
        console.error('Game History error:', e);
      }
    }

    function placeColorBet(color) {
      alert(`Color Bet placed on ${color}`);
    }

    function placeNumberBet(number) {
      alert(`Number Bet placed on ${number}`);
    }

    fetchWallet();
  </script>
</body>
</html>
