<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>WinGo Game</title>
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: #f3f4f6;
    }
    header {
      background-color: #111827;
      color: white;
      padding: 10px 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    header h1 {
      margin: 0;
      font-size: 1.5rem;
    }
    #wallet-balance {
      font-size: 1rem;
    }

    .button-grid, .number-grid {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      margin: 20px;
      gap: 10px;
    }

    .color-button, .number-button {
      padding: 15px 25px;
      font-size: 1.2rem;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      color: white;
      transition: transform 0.1s ease-in-out;
    }

    .color-button:active, .number-button:active {
      transform: scale(0.95);
    }

    .red { background-color: #dc2626; }
    .green { background-color: #16a34a; }
    .violet { background-color: #7c3aed; }

    .number-button {
      background-color: #1e293b;
    }

    /* Bet Popup */
    #bet-popup {
      display: none;
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.5);
      justify-content: center;
      align-items: center;
      z-index: 999;
    }

    #bet-popup .popup-content {
      background: white;
      padding: 20px;
      border-radius: 10px;
      text-align: center;
      width: 90%;
      max-width: 350px;
    }

    .amount-options button {
      padding: 10px 20px;
      margin: 10px 5px;
      font-size: 1rem;
      border: 1px solid #ccc;
      border-radius: 5px;
      cursor: pointer;
    }

    .multiplier {
      margin: 10px 0;
      font-weight: bold;
    }

    .popup-actions button {
      padding: 10px 20px;
      margin: 10px;
      font-size: 1rem;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }

    .confirm-btn {
      background-color: #10b981;
      color: white;
    }

    .cancel-btn {
      background-color: #ef4444;
      color: white;
    }
  </style>
</head>
<body>

<header>
  <h1>ðŸŽ¯ WinGo</h1>
  <div id="wallet-balance">Balance: â‚¹0</div>
</header>

<!-- Color Buttons -->
<div class="button-grid">
  <button class="color-button red" onclick="openBetPopup('Red')">Red</button>
  <button class="color-button green" onclick="openBetPopup('Green')">Green</button>
  <button class="color-button violet" onclick="openBetPopup('Violet')">Violet</button>
</div>

<!-- Number Buttons -->
<div class="number-grid">
  <button class="number-button" onclick="openBetPopup('0')">0</button>
  <button class="number-button" onclick="openBetPopup('1')">1</button>
  <button class="number-button" onclick="openBetPopup('2')">2</button>
  <button class="number-button" onclick="openBetPopup('3')">3</button>
  <button class="number-button" onclick="openBetPopup('4')">4</button>
  <button class="number-button" onclick="openBetPopup('5')">5</button>
  <button class="number-button" onclick="openBetPopup('6')">6</button>
  <button class="number-button" onclick="openBetPopup('7')">7</button>
  <button class="number-button" onclick="openBetPopup('8')">8</button>
  <button class="number-button" onclick="openBetPopup('9')">9</button>
</div>

<!-- Bet Popup -->
<div id="bet-popup">
  <div class="popup-content">
    <h3 id="bet-choice-title">Place Bet</h3>
    <div class="amount-options">
      <button onclick="selectAmount(1)">â‚¹1</button>
      <button onclick="selectAmount(10)">â‚¹10</button>
      <button onclick="selectAmount(100)">â‚¹100</button>
    </div>
    <div class="multiplier" id="multiplier-text">Multiplier: x0</div>
    <div class="popup-actions">
      <button class="confirm-btn" onclick="confirmBet()">Confirm</button>
      <button class="cancel-btn" onclick="closeBetPopup()">Cancel</button>
    </div>
  </div>
</div>

<script>
  const token = localStorage.getItem("token");
  const email = localStorage.getItem("email") || "user@example.com";
  let selectedChoice = "";
  let selectedAmount = 0;

  async function fetchWalletBalance() {
    try {
      const res = await fetch(`https://wingo-backend-nqk5.onrender.com/api/users/wallet/${email}`, {
        headers: { Authorization: `Bearer ${token}` }
      });
      const data = await res.json();
      document.getElementById("wallet-balance").textContent = `Balance: â‚¹${data.wallet}`;
    } catch (err) {
      console.error("Wallet fetch failed", err);
    }
  }

  function openBetPopup(choice) {
    selectedChoice = choice;
    selectedAmount = 0;
    document.getElementById("bet-choice-title").innerText = `Bet on ${choice}`;
    document.getElementById("multiplier-text").innerText = "Multiplier: x0";
    document.getElementById("bet-popup").style.display = "flex";
  }

  function closeBetPopup() {
    document.getElementById("bet-popup").style.display = "none";
  }

  function selectAmount(amount) {
    selectedAmount = amount;
    let multiplier = 0;
    if (["Red", "Green"].includes(selectedChoice)) multiplier = 2;
    else if (selectedChoice === "Violet") multiplier = 4.5;
    else multiplier = 9; // for number bets
    document.getElementById("multiplier-text").innerText = `Multiplier: x${multiplier}`;
  }

  function confirmBet() {
    if (!selectedAmount) {
      alert("Please select an amount");
      return;
    }
    alert(`Bet Placed!\nType: ${selectedChoice}\nAmount: â‚¹${selectedAmount}`);
    closeBetPopup();
    // TODO: POST bet to backend
  }

  fetchWalletBalance();
</script>

</body>
</html>
