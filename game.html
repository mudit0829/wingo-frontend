<!DOCTYPE html><html><head><meta charset="UTF-8"><title>Game</title><style>button, input{margin:5px}</style></head><body>
  <h2>Welcome, <span id="user"></span></h2>
  <p>Role: <span id="role"></span> <button onclick="logout()">Logout</button></p>
  <h3>Place Bet</h3>
  <select id="color"><option>Red</option><option>Green</option><option>Violet</option></select>
  <input type="number" id="amount" placeholder="Amount">
  <button onclick="place()">Place Bet</button>
  <p id="status"></p>
  <h3>Current Result</h3><p id="result">Loading...</p>
  <h3>Your Bets</h3><ul id="bets"></ul>
  <script>
    const u = localStorage.getItem("username");
    if (!u) window.location.href="index.html";
    document.getElementById("user").innerText = u;
    document.getElementById("role").innerText = localStorage.getItem("role");

    async function place(){
      const c = document.getElementById("color").value;
      const a = parseInt(document.getElementById("amount").value);
      if (!a || a<=0) {document.getElementById("status").innerText="Invalid amount";return;}
      const rounds = await fetch("https://wingo-backend-nqk5.onrender.com/api/rounds").then(d=>d.json());
      const id = rounds[0]?.roundId;
      const res = await fetch("https://wingo-backend-nqk5.onrender.com/api/bets", {
        method:"POST", headers:{"Content-Type":"application/json"},
        body: JSON.stringify({username:u,color:c,amount:a,roundId:id})
      });
      const jd = await res.json();
      document.getElementById("status").innerText = res.ok ? "Bet placed" : jd.message;
      load();
    }

    async function load(){
      const bets = await fetch(`https://wingo-backend-nqk5.onrender.com/api/bets/${u}`).then(d=>d.json());
      document.getElementById("bets").innerHTML = bets.map(b=>`<li>${b.color} ₹${b.amount} — ${b.status} (res:${b.resultColor||"TBD"})</li>`).join("");
      const rounds = await fetch("https://wingo-backend-nqk5.onrender.com/api/rounds").then(d=>d.json());
      const r = rounds[0];
      document.getElementById("result").innerText = `Round ${r.roundId} = ${r.result||"Pending"}`;
    }

    function logout(){localStorage.clear();window.location.href="index.html";}
    load();
    setInterval(load, 5000);
  </script>
</body></html>
