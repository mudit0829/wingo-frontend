<!DOCTYPE html><html><head><meta charset="UTF-8">
<title>WinGo Game</title>
<style>
  body {font-family: Arial; padding: 20px;}
  button {padding: 10px 20px; margin: 5px;}
  .won {color: green;} .lost {color: red;} .pending {color: orange;}
</style></head>
<body>

<h2>Welcome, <span id="userName"></span>!</h2>
<p>Role: <span id="userRole"></span></p>
<button onclick="logout()">Logout</button>

<hr />

<h3>Place Your Bet</h3>
<button onclick="placeBet('Red')">üî¥ Red</button>
<button onclick="placeBet('Green')">üü¢ Green</button>
<button onclick="placeBet('Violet')">üü£ Violet</button>
<p id="betStatus"></p>

<hr />

<h3>Your Last 5 Bets</h3>
<ul id="betHistory"><li>Loading...</li></ul>

<script>
  const username = localStorage.getItem("username");
  if (!username) window.location.href = "index.html";
  document.getElementById("userName").innerText = username;
  document.getElementById("userRole").innerText = localStorage.getItem("role");

  async function placeBet(color) {
    const amount = parseInt(prompt("Enter your bet amount:"));
    if (!amount || isNaN(amount)) {
      document.getElementById("betStatus").innerText = "‚ùå Invalid amount.";
      return;
    }
    const rounds = await (await fetch("https://wingo-backend-nqk5.onrender.com/api/rounds")).json();
    const roundId = rounds[0]?.roundId;
    const res = await fetch("https://wingo-backend-nqk5.onrender.com/api/bets", {
      method: "POST",
      headers: {"Content-Type":"application/json"},
      body: JSON.stringify({username, color, amount, roundId})
    });
    const data = await res.json();
    document.getElementById("betStatus").innerText = res.ok ? "‚úÖ "+data.message : "‚ùå "+(data.message||"Failed");
    loadBets();
  }

  async function loadBets() {
    const res = await fetch(`https://wingo-backend-nqk5.onrender.com/api/bets/${username}`);
    const bets = await res.json();
    const list = document.getElementById("betHistory");
    if (!bets.length) { list.innerHTML = "<li>No bets yet.</li>"; return; }
    list.innerHTML = bets.slice(0,5).map(b => {
      const cls = b.status==="Won" ? "won" : b.status==="Lost" ? "lost" : "pending";
      const emoji = b.status==="Won" ? "‚úÖ" : b.status==="Lost" ? "‚ùå" : "‚è≥";
      return `<li class="${cls}">${emoji} Color: <b>${b.color}</b> | Amount: ‚Çπ${b.amount} | Result: <b>${b.resultColor||"TBD"}</b></li>`;
    }).join("");
  }

  function logout() {
    localStorage.clear();
    window.location.href = "index.html";
  }

  loadBets();
  setInterval(loadBets, 10000);
</script>

</body></html>
