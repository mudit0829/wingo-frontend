<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>WinGo Game</title>
  <style>
    body { font-family: Arial; padding: 20px; }
    button { padding: 10px 20px; margin: 5px; }
    .won { color: green; }
    .lost { color: red; }
    .pending { color: orange; }
  </style>
</head>
<body>

  <h2 id="welcomeMsg">Welcome!</h2>
  <p id="userRole">Role: </p>
  <button onclick="logout()">Logout</button>

  <hr />

  <h3>Place Your Bet</h3>
  <button onclick="placeBet('Red')">üî¥ Red</button>
  <button onclick="placeBet('Green')">üü¢ Green</button>
  <button onclick="placeBet('Violet')">üü£ Violet</button>
  <p id="betStatus"></p>

  <hr />

  <h3>Your Last 5 Bets</h3>
  <ul id="betHistory"></ul>

  <script>
    const username = localStorage.getItem("username");
    const token = localStorage.getItem("token");

    if (!username || !token) {
      window.location.href = "index.html";
    }

    document.getElementById("welcomeMsg").innerText = `Welcome, ${username}!`;
    document.getElementById("userRole").innerText = `Role: ${localStorage.getItem("role")}`;

    async function placeBet(color) {
      const res = await fetch("https://wingo-backend-nqk5.onrender.com/api/bets/place", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ username, color })
      });

      const data = await res.json();
      document.getElementById("betStatus").innerText = data.message || "‚úÖ Bet placed!";
      loadBets();
    }

    async function loadBets() {
      const res = await fetch("https://wingo-backend-nqk5.onrender.com/api/bets/" + username);
      const bets = await res.json();

      const betList = bets.slice(-5).reverse().map(bet => {
        let statusText = '';
        let statusClass = '';

        if (bet.status === "Won") {
          statusText = "‚úÖ Won";
          statusClass = "won";
        } else if (bet.status === "Lost") {
          statusText = "‚ùå Lost";
          statusClass = "lost";
        } else {
          statusText = "‚è≥ Pending";
          statusClass = "pending";
        }

        return `<li>
          Color: <strong>${bet.color}</strong> |
          Status: <span class="${statusClass}">${statusText}</span> |
          Result: <strong>${bet.resultColor || "TBD"}</strong>
        </li>`;
      }).join("");

      document.getElementById("betHistory").innerHTML = betList || "<li>No bets yet.</li>";
    }

    function logout() {
      localStorage.clear();
      window.location.href = "index.html";
    }

    loadBets();
    setInterval(loadBets, 10000); // Auto-refresh bet history every 10 seconds
  </script>
</body>
</html>
