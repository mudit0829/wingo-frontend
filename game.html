<!DOCTYPE html>
<html>
<head>
  <title>WinGo Game</title>
</head>
<body>
  <h2>Welcome, <span id="userName"></span>!</h2>
  <p>Role: <span id="userRole"></span></p>
  <button onclick="logout()">Logout</button>

  <h3>Place Your Bet</h3>
  <select id="color">
    <option value="Red">Red</option>
    <option value="Green">Green</option>
    <option value="Violet">Violet</option>
  </select>
  <button onclick="placeBet()">Place Bet</button>
  <p id="betMessage"></p>

  <script>
    // Check if user is logged in
    const username = localStorage.getItem("username");
    const role = localStorage.getItem("role");
    if (!username) window.location.href = "index.html";

    document.getElementById("userName").textContent = username;
    document.getElementById("userRole").textContent = role;

    async function placeBet() {
      const color = document.getElementById("color").value;
      const amount = parseInt(prompt("Enter your bet amount:"));
      if (!amount || isNaN(amount)) {
        document.getElementById("betMessage").textContent = "Please enter a valid amount.";
        return;
      }

      try {
        // Fetch current round ID
        const rounds = await fetch("https://wingo-backend-nqk5.onrender.com/api/rounds")
          .then(res => res.json());
        const roundId = rounds[0]?.roundId;

        const response = await fetch("https://wingo-backend-nqk5.onrender.com/api/bets", {
          method: "POST",
          headers: {"Content-Type": "application/json"},
          body: JSON.stringify({ username, color, amount, roundId })
        });

        const data = await response.json();
        document.getElementById("betMessage").textContent = response.ok 
          ? "✅ Bet placed!"
          : "❌ " + (data.message || "Failed to place bet");
      } catch {
        document.getElementById("betMessage").textContent = "Network error.";
      }
    }

    function logout() {
      localStorage.clear();
      window.location.href = "index.html";
    }
  </script>
</body>
</html>
